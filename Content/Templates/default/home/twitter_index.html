<include file="home@index@head"/>

<div class="content">
    <div class="container">
        <div class="content-grids">
            <div class="col-md-8 content-main">


                <div class="content-grid">

                    <div class="content-grid-single">


                        <div class="content-form">

                                <ul class="chats">

                                    <php>
                                        foreach($list as $k=>$v)
                                        {
                                    </php>


                                    <li class="in comment_{$v['id']}">
                                        <img class="avatar" src="http://q1.qlogo.cn/g?b=qq&nk=435024179&s=100&t={:time()}">

                                        <div class="message" style="margin-left: 65px;">
											<span class="arrow">
											</span>
                                            <a href="#" class="name">
                                                {:member($v['author'])} </a>
											<span class="datetime">
											at {$v['crate_time']} </span>
											<span class="body">
											{$v['content']} </span>

                                            <div>
                                                <span aria-hidden="true" data="ref_1_like" class="ico icon-like" onclick="upDownComment(this)">1</span>
                                                <span aria-hidden="true" data="ref_1_dislike" class="ico icon-dislike" onclick="upDownComment(this)">1</span>
                                                <span aria-hidden="true" class="ico icon-speech" onclick="icon_speech(this)">评论</span>

                                                <div class="clearfix"></div>
                                            </div>


                                            <form class="rep_content">

                                                <input type="text" class="comment_name" name="name" placeholder="昵称" required="text">
                                                <input type="text" class="comment_qq" name="qq" placeholder="QQ" required="qq">
                                                <textarea name="content" class="comment_content" placeholder="内容" required="text"></textarea>


                                                <input type="button" style="width: 100px;height: 38px;" value="提交" onclick="addComment(this,{$v['id']},1);">

                                            </form>


                                        </div>
                                    </li>



                                    <php>

                                        }

                                    </php>


                                </ul>


                        </div>
                        <p class="loadMore">
                            <a href="javascript:;" data-page="{$p}" class=" btn blue  default btn-block" >
                                Load More </a>
                        </p>


                    </div>

                </div>


            </div>

            <div class="col-md-4 content-main-right">
                <div class="search">
                    <h3>SEARCH HERE</h3>

                    <form>
                        <input type="text" value="" onfocus="this.value=''" onblur="this.value=''">
                        <input type="submit" value="">
                    </form>
                </div>
                <div class="categories">
                    <h3>CATEGORIES</h3>
                    <li class="active"><a href="#">Donec quis dui at dolor tempor</a></li>
                    <li><a href="#">Vestibulum commodo felis quis tort</a></li>
                    <li><a href="#">Fusce pellentesque suscipit</a></li>
                </div>
                <div class="archives">
                    <h3>ARCHIVES</h3>
                    <li class="active"><a href="#">July 2014</a></li>
                    <li><a href="#">June 2014</a></li>
                    <li><a href="#">May 2014</a></li>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<script type="text/javascript" src="{:ADMIM_TPL_PATH}/plugins/layer/layer.min.js"></script>

<script>

    /**
     *  顶踩
     */
    function upDownComment(z) {
        var num = $(z).text();
        var data = $(z).attr("data").split("_")
        var id = data[1]
        var operationtype = data[2]
        $.ajax({
            url: "/index.php?m=home&c=comment&a=like",
            type: "post",
            dataType: "json",
            data: {
                id: id, operationtype: operationtype, type: "article", data:id
            },
            success: function (d) {
                if (d.status) {
                    z.animate({
                        fontSize: "16px"
                    })
                    z.text(++num);
                    z.animate({
                        fontSize: "12px"
                    })
                }
            }

        })
    }

    /*
    *验证是否有中文
    */
    function checkchinese(content){

        if(escape(content).indexOf("%u") < 0)
        {
            layer.msg('评论必须要有中文', 1, 8);
           return false
        }
    }

    /**
     * 隐藏评论区
     */
    function hideComment(){
        $(".chats").hide("slow")
    }

    /**
     * 显示评论区
     */
    function showComment(){
        $(".chats").show("slow")
    }


    /**
     *  显示评论区
     */
    function icon_speech(z) {
        $(z).parent().next().animate({

            height: "toggle"
        })
    }




    /**
     * 添加评论
     * @returns {boolean}
     */
    function addComment(z, ref_id, level) {
        var name = $.trim($(z).parent().find(".comment_name").val());
        var qq = $(z).parent().find(".comment_qq").val();
        var check_code = $(z).parent().find(".check_code").val();
        var content = $(z).parent().find(".comment_content").val();

        if (!name || !qq || !content) {
            layer.msg('请完整填写各字段', 1, 8);
            return false;
        }
        var re = /\d{5,11}/;
        if (!re.test(qq)) {
            layer.msg('QQ格式错误', 1, 8);
            return false;
        }

        var blogid = {$blog['id']}


        $.ajax({
            url: "/index.php?m=home&c=comment&a=add",
            type: "post",
            dataType: "json",
            timeout: 5000,
            data: {

                name: name, qq: qq, content: content, data: blogid, ref_id: ref_id, level: level, check_code: check_code

            },
            beforeSend: function () {
                var load = layer.load('提交中', 3);
            },
            success: function (d) {
                layer.close("load")
                if (d.status) {
                    layer.msg('提交成功', 3, {
                        type: 9,
                        rate: 'bottom',
                        shade: [0]
                    });
                    if (ref_id == 0) {
                        $(".chats").prepend(d.html)
                    } else {

                        $(z).parent().animate({
                            height: "0px"
                        })
                        $(z).parent().hide()

                        $(".comment_" + ref_id).after(d.html)
                    }
                    $('#comment_form')[0].reset()
                } else {
                    layer.msg(d.msg, 1, 8);
                }
            },
            error: function () {
                layer.msg('提交失败', 1, 8);
            },
            complete: function (XMLHttpRequest, status) {
                if (status == 'timeout') {
                    ajaxTimeoutTest.abort();
                    layer.alert("超时!", 1, 8)
                }
            }

        })
        return false;


    }


</script>


<include file="home@index@foot"/>
